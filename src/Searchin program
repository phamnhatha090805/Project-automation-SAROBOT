{attribute :Pragma;}
Program PLC_PRG
VAR
    Distance, Color_Red, Distance_mm : REAL;
    ValueForRed : INT := 20; 
    DetectRange : REAL := 100.0; 
    
    MoveX, MoveY : REAL := 0.0; 
    Speed        : REAL := 0.5;

    
    Max_Radius     : REAL := 50.0;    
    Increment      : REAL := 16.666;  
    Current_Radius : REAL := 16.666;  
    Loop_Counter   : INT := 1;        
    
    Step_nr      : INT := 0;
    Object_Found : BOOL := FALSE; 
    Finished     : BOOL := FALSE; 
END_VAR

Distance_mm := (Distance / 10.0) * 100.0; 

IF (Distance_mm > DetectRange AND Color_Red > ValueForRed) THEN
    Object_Found := TRUE; 
END_IF

IF NOT Object_Found AND NOT Finished THEN
    CASE Step_nr OF
        0: 
           IF MoveX < Current_Radius THEN 
               MoveX := MoveX + Speed;
           ELSE 
               Step_nr := 1; 
           END_IF

        1: 
           IF MoveY < Current_Radius THEN 
               MoveY := MoveY + Speed;
           ELSE 
               Step_nr := 2; 
           END_IF

        2: 
           IF MoveX > (Current_Radius * -1.0) THEN 
               MoveX := MoveX - Speed;
           ELSE 
               Step_nr := 3; 
           END_IF

        3: 
           IF MoveY > (Current_Radius * -1.0) THEN 
               MoveY := MoveY - Speed;
           ELSE 
               Step_nr := 4; 
           END_IF

        4: 
           IF Loop_Counter < 3 THEN
               Loop_Counter := Loop_Counter + 1;
               Current_Radius := Current_Radius + Increment; 
               
               IF Current_Radius > Max_Radius THEN 
                   Current_Radius := Max_Radius; 
               END_IF;
               
               Step_nr := 0; 
           ELSE
               Finished := TRUE; 
               Step_nr := 99;
           END_IF

        99: ; 
    END_CASE
END_IF